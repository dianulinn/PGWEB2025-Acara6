<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peta Flores Timur</title>

  <!-- Memuat file CSS dari library eksternal -->
  <!-- Bootstrap CSS untuk styling komponen UI -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons untuk ikon-ikon -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Leaflet CSS untuk tampilan peta -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet Search CSS untuk plugin pencarian -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.9/dist/leaflet-search.min.css" />

  <style>
    /* Mengatur layout body agar map mengisi sisa ruang */
    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }

    /* Mengatur agar div map mengisi sisa tinggi dan lebar */
    #map {
      flex-grow: 1;
      width: 100%;
    }

    /* Menambah lebar minimum untuk kontrol layer agar legenda muat */
    .leaflet-control-layers-expanded {
      min-width: 230px;
    }

    /* Styling dasar untuk kontainer legenda di dalam kontrol layer */
    .legend-in-control {
      font-size: 0.9em;
      margin-left: 25px;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    /* Styling untuk setiap item dalam legenda */
    .legend-in-control .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }

    /* Styling untuk simbol warna (kotak) pada legenda poligon */
    .legend-in-control i {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      opacity: 0.8;
      flex-shrink: 0;
    }

    /* Styling untuk simbol garis pada legenda */
    .legend-in-control .legend-line {
      display: inline-block;
      width: 20px;
      margin-right: 8px;
      vertical-align: middle;
      opacity: 0.8;
      border-bottom-style: solid;
    }
  </style>
</head>

<body>
  <!-- Navbar (Menu Atas) menggunakan Bootstrap -->
  <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #FFE4E1;">
    <div class="container-fluid">
      <!-- Judul Peta -->
      <a class="navbar-brand" href="#">Flores Timur</a>
      <!-- Tombol toggler untuk tampilan mobile -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Konten Navbar yang bisa collaps -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <!-- Item menu "Tentang" yang akan memunculkan modal -->
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">Tentang</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Div kosong sebagai kontainer untuk peta Leaflet -->
  <div id="map"></div>

  <!-- Modal Bootstrap untuk menampilkan informasi fitur (pop-up) -->
  <div class="modal fade" id="featureModal" tabindex="-1" aria-labelledby="featureModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="featureModalLabel">Informasi Kecamatan</h5><button type="button" class="btn-close"
            data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="featureModalBody"></div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Bootstrap untuk menampilkan informasi "Tentang" -->
  <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="aboutModalLabel">Tentang Peta Ini</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Peta Web Interaktif wilayah Flores Timur.</p>
          <p>Dibuat oleh:</p>
          <p>Nama: Dian Ulin Nuha</p>
          <p>NIM: 24/540088/SV/24771</p>
          <p>Kelas: B</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Memuat file JavaScript dari library eksternal -->
  <!-- Leaflet JS untuk fungsionalitas peta -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet Search JS untuk plugin pencarian -->
  <script src="https://unpkg.com/leaflet-search@3.0.9/dist/leaflet-search.min.js"></script>

  <!-- Script Utama Aplikasi Peta -->
  <script>
    // Menjalankan script setelah semua elemen DOM selesai dimuat
    document.addEventListener('DOMContentLoaded', function () {
      // Inisialisasi peta Leaflet pada div dengan id 'map'
      // setView([latitude, longitude], zoomLevel)
      var map = L.map('map').setView([-8.45, 122.98], 10);

      // Membuat "pane" kustom untuk mengontrol urutan tumpukan layer (zIndex)
      // Layer dengan zIndex lebih tinggi akan tampil di atas
      map.createPane('batasPane'); map.getPane('batasPane').style.zIndex = 410;
      map.createPane('sungaiPane'); map.getPane('sungaiPane').style.zIndex = 415;
      map.createPane('jalanPane'); map.getPane('jalanPane').style.zIndex = 420;
      map.createPane('toponimiPane'); map.getPane('toponimiPane').style.zIndex = 430;

      // Mendefinisikan base map (peta dasar)
      // OSM, ditambahkan langsung ke peta saat inisialisasi
      var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap' }).addTo(map);
      // Esri Satelit, akan tersedia sebagai pilihan di kontrol layer
      var esriSatelit = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles &copy; Esri' });

      // Membuat layer group untuk setiap jenis data overlay
      // Layer group ini akan menampung data GeoJSON dan ditambahkan ke kontrol layer
      var batasKecamatanLayer = L.layerGroup().addTo(map);
      var sungaiLayer = L.layerGroup().addTo(map);
      var jalanLayer = L.layerGroup().addTo(map);
      var toponimiLayer = L.layerGroup().addTo(map);

      // Fungsi untuk menentukan warna poligon berdasarkan jumlah penduduk
      function getColor(p) { return p > 30000 ? '#8c510a' : p > 15000 ? '#bf812d' : '#dfc27d'; }
      // Fungsi untuk styling layer Batas Kecamatan
      function style(feature) { return { fillColor: getColor(feature.properties.Penduduk), weight: 2, opacity: 1, color: 'white', dashArray: '3', fillOpacity: 0.7 }; }
      // Fungsi untuk menentukan ketebalan garis jalan
      function getJalanWeight(namaUnsur) { switch (namaUnsur) { case 'Jalan Propinsi': return 4; case 'Jalan Kabupaten': return 2.5; default: return 1; } }
      // Fungsi untuk styling layer Jalan
      function styleJalan(feature) { return { color: 'red', weight: getJalanWeight(feature.properties.NAMA_UNSUR) }; }

      // Inisialisasi modal Bootstrap untuk pop-up informasi
      var featureModal = new bootstrap.Modal(document.getElementById('featureModal'), {});

      // Memuat data GeoJSON Batas Kecamatan
      fetch('Data/Batas_Kecamatan.geojson')
        .then(function (response) { return response.json(); }) // Mengubah response menjadi JSON
        .then(function (data) { // Bekerja dengan data JSON
          // Membuat layer GeoJSON dari data
          L.geoJSON(data, {
            style: style, // Menerapkan style dari fungsi style()
            pane: 'batasPane', // Menempatkan layer ini di pane 'batasPane'
            onEachFeature: function (feature, layer) { // Fungsi yang dijalankan untuk setiap fitur
              // Menambahkan tooltip yang menampilkan nama kecamatan
              if (feature.properties && feature.properties.WADMKC) { layer.bindTooltip(feature.properties.WADMKC, { sticky: true }); }
              // Menambahkan event listener 'click' pada setiap fitur
              layer.on('click', function (e) {
                var props = e.target.feature.properties;
                if (props) {
                  // Mengisi dan menampilkan modal dengan informasi dari fitur yang diklik
                  document.getElementById('featureModalLabel').innerHTML = 'Informasi: ' + props.WADMKC;
                  document.getElementById('featureModalBody').innerHTML = '<p><strong>Kecamatan:</strong> ' + props.WADMKC + '</p>' + '<p><strong>Penduduk:</strong> <i class="bi bi-people-fill"></i> ' + props.Penduduk + '</p>';
                  featureModal.show();
                }
              });
            }
          }).addTo(batasKecamatanLayer); // Menambahkan layer GeoJSON ke dalam layer group

          // Membuat kontrol pencarian (Leaflet Search)
          var searchControl = new L.Control.Search({
            layer: batasKecamatanLayer, // Mencari di dalam layer batas kecamatan
            propertyName: 'WADMKC', // Mencari berdasarkan properti 'WADMKC'
            marker: false, // Tidak menampilkan marker hasil pencarian
            initial: false, // Tidak melakukan pencarian awal
            textPlaceholder: 'Cari Kecamatan...', // Teks placeholder di input pencarian
            zoom: 13 // Zoom ke level 13 saat hasil ditemukan
          });
          map.addControl(searchControl); // Menambahkan kontrol pencarian ke peta
        });

      // Memuat data GeoJSON lainnya dengan cara yang lebih ringkas
      fetch('Data/Sungai.geojson').then(r => r.json()).then(d => { L.geoJSON(d, { style: { color: '#0000FF', weight: 1.5 }, pane: 'sungaiPane' }).addTo(sungaiLayer); });
      fetch('Data/Jalan.geojson').then(r => r.json()).then(d => { L.geoJSON(d, { style: styleJalan, pane: 'jalanPane' }).addTo(jalanLayer); });
      fetch('Data/Toponimi.geojson').then(r => r.json()).then(d => { L.geoJSON(d, { onEachFeature: (f, l) => { if (f.properties && f.properties.TOPONIMI) { l.bindTooltip(f.properties.TOPONIMI); } }, pane: 'toponimiPane' }).addTo(toponimiLayer); });

      // membuat HTML legenda jumlah penduduk
      function getPendudukLegendHtml() { var g = [0, 15000, 30000]; var h = '<div class="legend-in-control"><strong>Penduduk</strong>'; for (var i = 0; i < g.length; i++) { h += '<div class="legend-item"><i style="background:' + getColor(g[i] + 1) + '"></i> <span>' + g[i] + (g[i + 1] ? '&ndash;' + g[i + 1] : '+') + '</span></div>'; } return h + '</div>'; }
      // membuat HTML legenda jenis jalan
      function getJalanLegendHtml() { var t = { 'Jalan Propinsi': 4, 'Jalan Kabupaten': 2.5, 'Jalan Lain': 1 }; var h = '<div class="legend-in-control"><strong>Jenis Jalan</strong>'; for (var type in t) { var w = t[type]; h += '<div class="legend-item"><span class="legend-line" style="border-color: red; border-bottom-width: ' + w + 'px;"></span> <span>' + type + '</span></div>'; } return h + '</div>'; }
      // membuat HTML legenda sungai
      function getSungaiLegendHtml() { return '<div class="legend-in-control"><div class="legend-item"><span class="legend-line" style="border-color: blue; border-bottom-width: 1.5px;"></span> <span>Sungai</span></div></div>'; }

      // Mendefinisikan objek base maps untuk kontrol layer
      var baseMaps = { "OpenStreetMap": osm, "Esri Satelit": esriSatelit };
      // Mendefinisikan objek overlay maps, menyisipkan HTML legenda ke dalam nama layer
      var overlayMaps = { [`Batas Kecamatan${getPendudukLegendHtml()}`]: batasKecamatanLayer, [`Sungai${getSungaiLegendHtml()}`]: sungaiLayer, [`Jalan${getJalanLegendHtml()}`]: jalanLayer, "Toponimi": toponimiLayer };

      // Menambahkan kontrol layer ke peta
      L.control.layers(baseMaps, overlayMaps).addTo(map);
    });
  </script>

  <!-- Memuat Bootstrap JS Bundle (termasuk Popper.js) untuk fungsionalitas komponen seperti modal -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>